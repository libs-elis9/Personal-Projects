def num_coincidences(message, K):
  count = 0
  for i in range(len(message)-K):
    kth_l = message[i+K]
    if kth_l == message[i]:
      count += 1
  return count

def key_length(message):
  max = 0
  k_max = 0
  for k in range(1,21):
    v = num_coincidences(message, k)
    if v > max:
      max = v
      k_max = k
  return k_max

def decrypt(key, message):
  alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
  enc_key = []
  for i in range(0, len(message)):
    enc_key.append(alpha.find(key[i % len(key)]))
  return enc_key

def vigenere_decrypt(key, message):
  alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
  key = decrypt(key, message)
  code = []
  for m,k in zip(message,key):
    e_m = int(alpha.find(m))
    code.append(alpha[(e_m-k) % 26])
  return "".join(code)

def shift_encrypt_letter(n,letter):
  if letter != " ":
    alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    num = alpha.find(letter)
    num = str(num)
    if len(num) < 2:
      num = "0" + num
    n_num = int(num) + n
    n_num = n_num % 26
    return alpha[n_num]
  else:
    return " "

def shift_encrypt(n,s):
  L = [shift_encrypt_letter(n,let) for let in s]
  return ''.join(L)

def shift_decrypt(n,s):
  n = 26 - n
  return shift_encrypt(n,s)

def str_split(s,j,k):
  return "".join([s[i] for i in range(0,len(s)) if (i-j)%k ==0])

def letter_freq(s):
  alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
  return [s.count(f)/len(s) for f in alpha]

def maximize_dot(string):
  F = [.082, .015, .028, .043, .127, .022, .020, .061, .070, .002, .008, .040, .024, .067, .075, .019, .001, .060, .063, .091, .028, .010, .023, .001, .020, .001]
  alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'

  freq_list = [letter_freq(shift_decrypt(m,string)) for m in range(26)]
  dot_list = [sum([freq*f for freq, f in zip(freq_list[m],F)]) for m in range(26)]

  return dot_list.index(max(dot_list))

def vigenere_crack(message):
  alpha = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
  k = key_length(message)
  strings = [str_split(message,j,k) for j in range(k)]
  key = ''
  for j in range(k):
    m = maximize_dot(strings[j])
    key += alpha[m]
  return [key, vigenere_decrypt(key, message)]


vigenere_crack('OMRBBUEKATNOWXZVNMXJSVPUBJZEIIIBQOMOIZVSMQOAPOYFXUIEQDZAWZGIATMWBTWSOPCYDFIYRQTNPBUNTUSFPCFIQAGEWBTGFASUBRXMLCNWOJBGHTVDVRGAJKNLEMRZAGQMNCIIIBQEOYFBBBXKOYNSPQQCIZQJRRWDSQCALUMSCHTFZFFTUWYABMNMBNMPSNWHTPZVTRWTUKGFPUOSMWBRCBPNGFILBSEOFEKWRGTZURTMIIWZAKZWRFHTFJYAVSGZKHTBAVNXDSEUOINGSAMPSEQFYZUBTAMFNPRZFDRRLIKNPMXJSRNXAGBHSUUPRRHNHUGARPZGHXQFQCMEXMEEEWBTDSRPZRTAMRNAGAGXUOMWUECDTTULFBZGGHOZDQRSKMUNTRUOOJHTBHUGMIFZRLBSSJGFQVVEETACACPXZLRRBDSQHFANBUEBZHBOPEUWAELBVRUVMQMBFMPSYGHFFZFOGUMSCHTFZFGTDSZGOZPLQIWMOGJOFIMJALIGDWODFAGONBRNTYYBVJIMPQHTZKCTNCDPOVTTDPUGHXKVNTOOUMEAGLHHTBAGBUEBVGPTWBUQBNTTGBISASOVAGIKVHSAGBUETJCIGWPSMJAVPWYFWEIKBNVTIFKCZUPNTFGABVVQSENSYZSPMZQEIADLQQXNMFPNVVXTWGVZQTBBNXTCMGBSFARAVPOOQIFBNBOMIBQCVMMNYOGOKUKQTXMEETZFNPUQEQAAGMOGTCICMFIWMHUGWDHZNVXIBQYSDFANCKMRGQHTFURMHZMBHTUWMYIMBZRDFAUPRRLWTZKBQXPBGTDSHRHDZQAGMWURVOXJDVNZMLPGSPJVTLRMOENMUOBUAMCBVXSDTIYSMZITIZQJIZIGLSOVSPGWEAUMZVGTUSMYIZQCHUZKFVGEKBOVPSPUPNTMPSLJOPBTYBXMBOQFZPVGHXQFOCQWTEVTABVRKFTBVQSBVHUGWDUZBULMFFRCOLMGSTVRUCRZFDRRMIYRPHTFUBUMQBGJWETBNTXWTRZWEUMACXWIEUKMTBUEFIFFJQAVVGRRLCJPPKUPRRBDSEYWFIQAALBVRTWHFZJONVRGYSZUGZIEMGBHHTFARAFGTVTGFNWFTOQJVFOZEJEOTLWZRFQTAVOGWTGJSUEMATBBMBHHTJVTSLMSZUHANMGOAIJRDSQOONIGMRBPOYFUBRTJZRTOIBNGEKVCBPHAXIEDLMJRPWZHIGSNKVNVWYFQSONVRBWHRPZPEKBOVPHTBBGHBAPYGOWQTNCXWJRTUDPEAWBBVAGHFMMFWTAHUGQTVZPHRIFQCBPUPNTIPWYKDBJZEIITOGGCRUPVSIIFVUVMOLNLLWURQFSJIAAPQTRQTFIMNBHDSJGFQEMNDTVROWFUFLNNWBVNVOXFFNNWMFOCFFIWYOFMKNDFMIIZTHJWNUOZEZBGXZWAHOZUKUIELFRPCRUPRAYWFRUOUEERRXIZFQRQBLNNWJIEKSPBVQTAIHGJSPBZXFEIHJKZPFZAELAPRACZEBUEVPIEEVKBZQIGBSEUSOUMQWBBVQKYQTIADFWIAFGMOLTAMMGJKHTTKNTMMFRFQMUBYEYMSQKBSPVVTPIGGJSYBZFHXAOAFHTBBGHXTCJNSMEMALBVSOGMAOLJALBVRTWHFZNNWBVNVHTFLVSMIBGUOHBORLTQFSTCYXPVCABVRYWZEENSKCGUKBSXIFTAMGRCOZEBUAMBVRUAMMTOUGLZRQTEIQIEKAUEQKUOONFKIWQQTUUIYLTVROGUUOVVNZBCPTMIBACIIPCYFMAVZAOBASPTWQEIGEKZWONSHPQPETAOZCBEUIETXLICHFANIZOGOHUGUDBDRSTBHUGGUEMBFMPSPJIDDPCOKKVXGSBTBVLEGCHNWFUTRDXDWYQFUMTPUMGCHTHTSWNTTNSNTTGMUNNTTZVPQABZFEZZOLYWFIITRXIHVTCZPVUILTSTCAMOEVTAVCUCHMOLJIMPPEQYQOAUOXAOAFKUUPNNHTRECUFJMQRHCBQJWEIMNDTUOAYVAIIQBXMBFQOWFLVNPIHRTOZEAZOMPSEGRUOUHDTVRYCAQEJLSMWBRUOZEKHTUGTYKBFTIADLBIAIPKOMGTEMGNPRFPZABRJFVCFEXPBLBUDRFOZEAUIOMFRFOZEOYAKMRNPRSSWJLXLOAFKTPARTXMHUEVMUBRRXLWAJWEIMNDTAVRUSUAMQMXJMGJSOIQAOALCAVQGUULTAZCNVGUSQCLXIRRFWZUMERHZDECMPPVGDHQHFKFFFTYULGCHTBMNMFABLHUGAMOYHIVSDVRGUSWACXUCEGGMJLGHXUOAUHMSQAGTBARIWHFQGMHCHURWBQQCSBZGUQKGTEUEKMMBWZUWMFABLHUGAMOXVNMWIGVVQQTNCXQDBKBFFLGOPPSEGCGSDVLEIURNOKPVGHXNZNVWZTPBRXIABPUFIMNLWMFGTSQTIADIWZYCFPTIZIEMCEOCDFNEOFBVREVGSKUTAMANPORUMELHWYVPUMUURFHZOZQAQOBGUKVSQOSGQAVDXLCJPOZEMZPMQSQOMBPKXEMAHUGFQXIFNHBVVPUUOBUEFJIGCDUFKROYJFRCRIIMATAMQUWFOIKNMXBCVVGQMNSOKPSJCGEPAHDWMBNPREUZBNZBVNVVQNIQEBBUBJSMEWIEKPSRNGNFNBRXUSNPRUTIJTAMGGGSBMMHNWMFZATQFBJHXVHUGQTVZPHVIARVCUUARLYQGNAWIBAFETBSQQBMIQTHMWAOUHAOMGRXUPYKBSXPVLXPSNVSFIMORXIRECJQOWHSEGMBWMAVVTDHOGNKRFIMZAGTWPMWZHPVSEQDFYVMUNNTVPSRMGKPCUAZWHVDSXJMIEMPSLYSDFNNTMPCHIVUXIFAMBVNVHUNMHNWMFFKNQENBRFGMRCFEBVQNHBGGTCZHLNRGUSVHWOPCYDGBSNVSYTIVDMPSZCBIJBUAMPFRCHQOQAGLPOXGCRIQFHXIRNPRUGQUAGBVNNTMNQADMWHVGODOMFTEGSKRFQTARDFGVBRSFIIGHXECHNRZUIADAMZQVWSIBRRMWHUGHANJFTHVSBPKTJKUHXPOQRIFNMCAKBZLVCWFMCMRASYHIBPVVTIIFGNMFPSREIUMFGZRGZBMVZMVPUZPEYOHSSRJSDFANIWBVROOZXPRRXAMBWFYPBUEKBVRTSEJZFABLWUGGFBZGEWUOQGOEIWETKCBNPREUWCPXLOAFZAPSRDHDSEJWETPBUELSEVVQSMFIKQHVOWPMGRXITOVPSPBTFOZMCEIWMOIGHTBGZAAAUPRRHPGNKRTFKBMBVUOCQWBVQILBVNVMAVZSAMPSECZAOORRRWIEOCFIMEYXAGVTGMJLVHBUHBQZMUMBFMPWFRODJAUHTPSZWHFFZRDMPSAECZTQQEKQBTYVAEGRLBDSJKHTTCCPHAWAACGSMXIGLZLNSFUWYIOMKUKQTJPNNMUOQGIBNGZIGLOOQIFNGFILBSEUWDNZFJHMUNTUQSGJIYMCSLCQHIEGXZMGJSNMIPKLUWGJGUSJYAVSGZKHTFPFABLVRCBPMWBKXLRBYBMUPVSEMUNHHQSLNRDTMYQCWJVTAMPWFNSSBVQMXASIGFMMBVMXAVREOYFKYOLMFGQAKUWZBLBCAGHAPSZEUGPBVVMSUFAGLHVNHQEURBTKYNUTMSIFHXKCHNRTPTQMXACGJOFIQFERMGYQCWFLZOLBDBYSDGCYLRLCJPWZUWZIGMOAFAUOMYOHSSQOCEUPRLITSFUZKVXVNMWVVUBAXTBODMSUGFQIMFABLHUGEGFAGIHVPRKBSXPRTAMFLQIDFBBBXTSGVCXJDRYHCYAQKIIIGAYQZRKGKFAFIKIBQACGLVBWPPOGYWFUTRSBAMRUGUSISTXZSNEVCVMFTBWBUGHUMBRDFMCIGFMMQGTEMABTSEPIFTHOWIGAQBOEETBSEUSZTMBFAMZCNSETVRSLIBQFOZHME')
# Test 1: ['COMBINATION', 'MYFATHERSFAMILYNAMEBEINGPIRRIPANDMYCHRISTIANNAMEPHILIPMYINFANTTONGUECOULDMAKEOFBOTHNAMESNOTHINGLONGERORMOREEXPLICITTHANPIPSOICALLEDMYSELFPIPANDCAMETOBECALLEDPIPIGIVEPIRRIPASMYFATHERSFAMILYNAMEONTHEAUTHORITYOFHISTOMBSTONEANDMYSISTERMRSJOEGARGERYWHOMARRIEDTHEBLACKSMITHASINEVERSAWMYFATHERORMYMOTHERANDNEVERSAWANYLIKENESSOFEITHEROFTHEMFORTHEIRDAYSWERELONGBEFORETHEDAYSOFPHOTOGRAPHSMYFIRSTFANCIESREGARDINGWHATTHEYWERELIKEWEREUNREASONABLYDERIVEDFROMTHEIRTOMBSTONESTHESHAPEOFTHELETTERSONMYFATHERSGAVEMEANODDIDEATHATHEWASASQUARESTOUTDARKMANWITHCURLYBLACKHAIRFROMTHECHARACTERANDTURNOFTHEINSCRIPTIONALSOGEORGIANAWIFEOFTHEABOVEIDREWACHILDISHCONCLUSIONTHATMYMOTHERWASFRECKLEDANDSICKLYTOFIVELITTLESTONELOZENGESEACHABOUTAFOOTANDAHALFLONGWHICHWEREARRANGEDINANEATROWBESIDETHEIRGRAVEANDWERESACREDTOTHEMEMORYOFFIVELITTLEBROTHERSOFMINEWHOGAVEUPTRYINGTOGETALIVINGEXCEEDINGLYEARLYINTHATUNIVERSALSTRUGGLEIAMINDEBTEDFORABELIEFIRELIGIOUSLYENTERTAINEDTHATTHEYHADALLBEENBORNONTHEIRBACKSWITHTHEIRHANDSINTHEIRTROUSERSPOCKETSANDHADNEVERTAKENTHEMOUTINTHISSTATEOFEXISTENCEOURSWASTHEMARSHCOUNTRYDOWNBYTHERIVERWITHINASTHERIVERWOUNDTWENTYMILESOFTHESEAMYFIRSTMOSTVIVIDANDBROADIMPRESSIONOFTHEIDENTITYOFTHINGSSEEMSTOMETOHAVEBEENGAINEDONAMEMORABLERAWAFTERNOONTOWARDSEVENINGATSUCHATIMEIFOUNDOUTFORCERTAINTHATTHISBLEAKPLACEOVERGROWNWITHNETTLESWASTHECHURCHYARDANDTHATPHILIPPIRRIPLATEOFTHISPARISHANDALSOGEORGIANAWIFEOFTHEABOVEWEREDEADANDBURIEDANDTHATALEXANDERBARTHOLOMEWABRAHAMTOBIASANDROGERINFANTCHILDRENOFTHEAFORESAIDWEREALSODEADANDBURIEDANDTHATTHEDARKFLATWILDERNESSBEYONDTHECHURCHYARDINTERSECTEDWITHDIKESANDMOUNDSANDGATESWITHSCATTEREDCATTLEFEEDINGONITWASTHEMARSHESANDTHATTHELOWLEADENLINEBEYONDWASTHERIVERANDTHATTHEDISTANTSAVAGELAIRFROMWHICHTHEWINDWASRUSHINGWASTHESEAANDTHATTHESMALLBUNDLEOFSHIVERSGROWINGAFRAIDOFITALLANDBEGINNINGTOCRYWASPIPHOLDYOURNOISECRIEDATERRIBLEVOICEASAMANSTARTEDUPFROMAMONGTHEGRAVESATTHESIDEOFTHECHURCHPORCHKEEPSTILLYOULITTLEDEVILORILLCUTYOURTHROATAFEARFULMANALLINCOARSEGRAYWITHAGREATIRONONHISLEGAMANWITHNOHATANDWITHBROKENSHOESANDWITHANOLDRAGTIEDROUNDHISHEADAMANWHOHADBEENSOAKEDINWATERANDSMOTHEREDINMUDANDLAMEDBYSTONESANDCUTBYFLINTSANDSTUNGBYNETTLESANDTORNBYBRIARSWHOLIMPEDANDSHIVEREDANDGLAREDANDGROWLEDANDWHOSETEETHCHATTEREDINHISHEADASHESEIZEDMEBYTHECHINOHDONTCUTMYTHROATSIRIPLEADEDINTERRORPRAYDONTDOITSIRTELLUSYOURNAMESAIDTHEMANQUICKPIPSIRONCEMORESAIDTHEMANSTARINGATMEGIVEITMOUTHPIPPIPSIRSHOWUSWHEREYOULIVESAIDTHEMANPINTOUTTHEPLACEIPOINTEDTOWHEREOURVILLAGELAYONTHEFLATINSHOREAMONGTHEALDERTREESANDPOLLARDSAMILEORMOREFROMTHECHURCHTHEMANAFTERLOOKINGATMEFORAMOMENTTURNEDMEUPSIDEDOWNANDEMPTIEDMYPOCKETSTHEREWASNOTHINGINTHEMBUTAPIECEOFBREADWHENTHECHURCHCAMETOITSELFFORHEWASSOSUDDENANDSTRONGTHATHEMADEITGOHEADOVERHEELSBEFOREMEANDISAWTHESTEEPLEUNDERMYFEETWHENTHECHURCHCAMETOITSELFISAYIWASSEATEDONAHIGHTOMBSTONETREMBLINGWHILEHEATETHEBREADRAVENOUSLYYOUYOUNGDOGSAIDTHEMANLICKINGHISLIPSWHATFATCHEEKSYOUHAGOTIBELIEVETHEYWEREFATTHOUGHIWASATTHATTIMEUNDERSIZEDFORMYYEARSANDNOTSTRONGDARNMEIFICOULDNTEATEMSAIDTHEMANWITHATHREATENINGSHAKEOFHISHEADANDIFIHANTHALFAMINDTOTIEARNESTLYEXPRESSEDMYHOPETHATHEWOULDNTANDHELDTIGHTERTOTHETOMBSTONEONWHICHHEHADPUTMEPARTLYTOKEEPMYSELFUPONITPARTLYTOKEEPMYSELFFROMCRYINGNOWLOOKEEHERESAIDTHEMANWHERESYOURMOTHERTHERESIRSAIDIHESTARTEDMADEASHORTRUNANDSTOPPEDANDLOOKEDOVERHISSHOULDERTHERESIRITIMIDLYEXPLAINEDALSOGEORGIANATHATSMYMOTHEROHSAIDHECOMINGBACKANDISTHATYOURFATHERALONGERYOURMOTHERYESSIRSAIDIHIMTOOLATEOFTHISPARISHHAHEMUTTEREDTHENCONSIDERINGWHODYELIVEWITHSUPPOSINYOUREKINDLYLETTOLIVEWHICHIHANTMADEUPMYMINDABOUTMYSISTERSIRMRSJOEGARGERYWIFEOFJOEGARGERYTHEBLACKSMITHSIRBLACKSMITHEHSAIDHEANDLOOKEDDOWNATHISLEGAFTERDARKLYLOOKINGATHISLEGANDMESEVERALTIMESHECAMECLOSERTOMYTOMBSTONETOOKMEBYBOTHARMSANDTILTEDMEBACKASFARASHECOULDHOLDMESOTHATHISEYESLOOKEDMOSTPOWERFULLYDOWNINTOMINEANDMINELOOKEDMOSTHELPLESSLYUPINTOHISNOWLOOKEEHEREHESAIDTHEQUESTIONBEINGWHETHERYOURETOBELETTOLIVEYOUKNOWWHATAFILEISYESSIRANDYOUKNOWWHATWITTLESISYESSIRAFTEREACHQUESTIONHETILTEDMEOVERALITTLEMORESOASTOGIVEMEAGREATERSENSEOFHELPLESSNESSANDDANGER']
